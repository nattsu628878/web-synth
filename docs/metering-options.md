# メータリング追加候補（Web Synth）

現在あるもの: **Level**（RMS/dB）、**Wave**（波形）、**Spectrum**（周波数スペクトラム）。

以下は追加候補。実装コストとDAWでの一般的さで整理。

---

## 1. 位相 / ゴニオメータ（Phase / Goniometer）

**何がわかるか**
- **ステレオの広がり**（L/R のバランス）
- **位相のずれ**（モノ相殺の原因）
- **相関**（左右が似ているか逆相か）

**表示**
- **Lissajous（リサージュ）**: 横軸 = L、縦軸 = R の 2D プロット。点が 45° 付近ならモノ寄り、横に広がるほどステレオ。
- **相関メーター**: 1本の針 or バーで -1〜+1（-1=逆相、0=無相関、+1=モノ）。

**実装**
- Web Audio では **ステレオ**が必要。`ChannelSplitterNode` で L/R に分け、それぞれに `AnalyserNode`（`getByteTimeDomainData`）を接続。
- 現在のマスターは実質モノなので、L/R を別々に取る経路を用意する必要あり。
- ゴニオ: 毎フレーム `x = L[i], y = R[i]` で点を打つ（またはヒストグラム風に重ねる）。
- 相関: `Σ(L*R) / sqrt(ΣL² * ΣR²)` を時間窓で計算。

**おすすめ度**: ★★★ ステレオミックスするならあると便利。

---

## 2. スペクトログラム（Spectrogram）

**何がわかるか**
- **時間 vs 周波数**の変化（どのタイミングでどの帯域が強いか）。
- キック・ベース・倍音の立ち上がりなどが一目でわかる。

**表示**
- 横 = 時間（右が最新）、縦 = 周波数、色 = レベル（例: 青〜黄〜白）。
- 幅は Wave と同じ、高さは Spectrum と同じ正方形 or 細長い帯でよい。

**実装**
- 既存の `getByteFrequencyData` を毎フレーム取得し、その 1 列分を画像の「右端」に描画し、全体を 1 ピクセル左にスクロール（リングバッファ or Canvas の `drawImage` で自コピー）。
- 追加ノードは不要（既存 Analyser で可）。

**おすすめ度**: ★★★ 実装が軽く、見た目も分かりやすい。

---

## 3. ウェーブレット（Wavelet）

**何がわかるか**
- **時間–周波数の局所性**（短いバーストと持続音を周波数帯域ごとに分けて表示）。
- スペクトログラムより「時間分解能」を帯域ごとに変えられる（低域は粗く、高域は細かく、など）。

**表示**
- 2D マップ（横=時間、縦=スケール or 周波数、色=係数）が一般的。

**実装**
- ブラウザ標準の API はなし。**JS でウェーブレット変換**（Haar、Daubechies など）を実装するか、ライブラリを入れる必要あり。
- 入力は `AnalyserNode` の time domain をまとめたバッファなど。計算負荷はスペクトラムより重い。
- 音楽制作では「位相・スペクトログラム」ほど一般的ではない。

**おすすめ度**: ★☆ 興味・研究向け。まずはスペクトログラムの方がコスパ良い。

---

## 4. その他（軽いもの）

| 種類 | 内容 | 実装 |
|------|------|------|
| **ピークホールド** | ピーク値を一定時間表示 | 現在の RMS に加えて `max(abs(sample))` を保持し、減衰表示 |
| **クレストファクター** | ピーク/RMS（ダイナミクス） | 既存の RMS とピークから計算して 1 本のバー or 数値 |
| **ヒストグラム** | サンプル値の分布 | `getByteTimeDomainData` をビン分けして棒グラフ |
| **VU 風** | 遅い応答の「体感音量」 | レベルメーターの smoothing を強くして表示を遅くするだけ |

---

## まとめ（優先度の目安）

1. **スペクトログラム** … 既存 Analyser だけででき、見た目も分かりやすい。まずここを足すのがおすすめ。
2. **位相 / ゴニオ・相関** … ステレオ出力にしたときに、位相・相関メーターを足すと便利。
3. **ウェーブレット** … やりたい場合は「時間–周波数」はまずスペクトログラムで満足できるか試してから検討でよい。

位相は「ステレオの状態」、ウェーブレットは「時間–周波数の詳細」用。一般的なメータリングなら **位相（ゴニオ/相関）** と **スペクトログラム** の 2 つを押さえておくと十分です。
